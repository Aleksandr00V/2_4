```mermaid
stateDiagram-v2
    direction LR
    
    [*] --> Очікування_картки
    
    Очікування_картки --> Очікування_введення_ПІН_коду : картка вставлена
    Очікування_картки --> [*] : (завершення роботи)
    
    Очікування_введення_ПІН_коду --> Перевірка_ПІН_коду : ПІН-код введений
    Очікування_введення_ПІН_коду --> Повернення_картки : відміна транзакції
    
    Перевірка_ПІН_коду --> Очікування_вибору_клієнта : [ПІН-код вірний]
    Перевірка_ПІН_коду --> Очікування_введення_ПІН_коду : [ПІН-код невірний]
    Перевірка_ПІН_коду --> Завершення_транзакції : три невдачі / конфіскація картки
    
    Очікування_вибору_клієнта --> Обробка_запиту_на_зняття_готівки : вибір суми [сума введена]
    Очікування_вибору_клієнта --> Обробка_запиту_на_отримання_довідки : вибір довідки
    Очікування_вибору_клієнта --> Повернення_картки : відміна транзакції
    
    Обробка_запиту_на_зняття_готівки --> Видача_готівки : [кредит не перевищений]
    Обробка_запиту_на_зняття_готівки --> Повернення_картки : [кредит перевищений] / повідомлення
    
    Обробка_запиту_на_отримання_довідки --> Друк : довідка сформована
    
    Видача_готівки --> Друк : готівка видана [обрано друк чека]
    Видача_готівки --> Повернення_картки : готівка видана [друк чека не обрано]
    
    Друк --> Повернення_картки : друк закінчений
    
    Повернення_картки --> Завершення_транзакції : картка повернута
    
    Завершення_транзакції --> Очікування_картки : транзакція завершена
